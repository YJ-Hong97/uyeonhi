<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
	integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
	integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
	crossorigin="anonymous"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
	integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
	crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Libre+Barcode+39+Text&display=swap"
			rel="stylesheet">
	<style type="text/css">
		.doMatch {
			border: none;
			background-color: #B983FF;
			color: white;
		}
		.matcardc{
			font-family: 'Gowun Dodum';
			font-style: normal;
			display: inline-block;
		}
		.matcard{
			display: inline-block;
			border-radius: 2rem;
			transition-duration: 1s;
		}
		.favDiv .card-text{
			display: inline-block;
			border-radius: 0.5rem;
			background-color:  rgba(185, 131, 255, 0.6);
			margin-right: 1%;
			cursor: pointer;
			
		}
		.pevCard {
			filter : blur(3px);
			display: inline-block;
			pointer-events: none;
			transition-duration: 1s;
		}
		.pevpevCard {
			display: none;
		}
		.favDiv{
			height: 10vh;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.favModal{
			display:none;
			position:absolute;
			top:50%;
			left:50%;
			transform:translate(-50%,-50%);
			
			width:30%;
			border-radius:1rem;
			background-color: rgba(0, 0, 0, 0.2);
			
			padding:2%;
		}
		.favModal p{
			display: inline-block;
			border-radius: 0.5rem;
			background-color:  rgba(185, 131, 255, 1);
			margin-right: 1%;
			cursor: pointer;
		}
		#favModalClose{
			cursor: pointer;
		}
		.blockMessage{
			display: none;
		}
		
		#slidecontainerreal {
			width: 994px;
			margin: auto;
		}
		.cardContainer {
			margin-top: 60px;
		}
		.favDiv {
			height: 70px;
		}
		
		.pev, .next {
			display: inline-block;
			height: 474px;
			margin-top: -410px;
			padding-top: 220px;
			color: white;
			background-color: rgba(185, 131, 255, 0.8);
		}
		.pev {
			margin-right: 10px;
		}
		.next {
			margin-left: 10px;
		}
		#postmodum {
			height: 700px;
			overflow: auto;
		}
	</style>
</head>
<body>
<th:block th:replace="~{/fragment/header::header}"></th:block>
	<div id="slidecontainerreal">
		<div class="pev btn"> &lt;</div>
		
		<div class = "cardContainer matcardc" th:each = "target:${targets}">
			<div class="card matcard pevCard" style="width: 18rem;">
			  <img th:src="${target.key.target.profile[0].fileName}" height="300vh" class="card-img-top" alt="..." id = "cardImg">
			  <div class="card-body">
			    <h5 class="card-title">[[${target.key.target.name}]]([[${target.key.target.nickname}]])</h5>
			    <div class = "favDiv">
			    	<p class="card-text"  th:each ="fav:${target.value}"th:value = "${target.value}">#[[${fav}]]</p>
			    </div>
			    <div class="d-flex justify-content-between cardbutton">
			    	<p th:if="${target.key.block}==1" style="display: block" class = "blockMessage">차단된 사용자입니다.</p>
				    <a th:unless="${target.key.block}==1" href="#" class="btn btn-secondary" th:value = "${target.key.target.id}">차단</a>
				    <a th:unless="${target.key.block}==1" href="#" class="btn doMatch" th:data-targetId="${target.key.target.id}">매칭 신청</a>
			    </div>
			  </div>
			</div>
		</div>
		<div class="next btn"> &gt;</div>
	</div>
	<div id="postmodum" class="d-flex justify-content-evenly flex-wrap listt">
	</div>
	<div class = "favModal">
		
	</div>
	
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script th:inline="javascript">
	//차단하기
	$('.btn-secondary').click(function(){
		alert("다음 우연히부터 이 사람은 보이지 않습니다.\n차단하기를 해제하려면 아는 사람 만나지 않기에서 삭제해 주세요.");
		let buser = $(this).attr("value");
		let mid = /*[[${session.user.id}]]*/'default';
		$.ajax({
			url:"/matchingBlock",
			type:"post",
			data:{buser:buser, mid:mid},
			success:function(){
				location.reload();
			}
		});
	});
		$(".doMatch").click(function() {
			var targetId = $(this).attr("data-targetid");
			$.ajax({
				url:"/matching",
				data:{target: targetId},
				success:function(responseData){
					alert(responseData);
					$(this).html("매칭신청중..");
				},
				fail:function(){
					alert("매칭 신청을 실패하셨습니다.")
				}
			});
		});
	
		 $('.card-text').click(function(){
			 $('.favModal').css("display","block");
			 let fav = $(this).attr("value").replace("[","");
			 fav = fav.replace("]","");
			 favarr = fav.split(",");
			 let inputData = "<div id = 'favModalClose'>X</div>";
			 for(let i in favarr){
				 inputData+=`<p>#${favarr[i]}</p>`;
			 }
			 $('.favModal').html(inputData);
			 
			 $('#favModalClose').click(function(){
				 $('.favModal').css("display","none");
			 });
		 });
		 var i = 0;
		 var maxSize = [[${targets.size}]];
		 
		 if(i == 0) {
			 var currentcard = $(".matcard")[i];
			 currentcard.classList.remove("pevCard");
			 for(var j = 3; j < maxSize; j++) {
				 $(".matcard")[j].classList.add("pevpevCard");
			 }
		 }
		 
		 $(".next").click(()=>{
			 i++;
			 if( i == 0) {
				 var currentcard = $(".matcard")[i];
				 var nextcard = $(".matcard")[i+1];
				 currentcard.classList.remove("pevCard");
				 nextcard.classList.add("pevCard");
				 nextcard.classList.remove("pevpevCard");
			 }
			 else if ( i >= 1) {
				 var pevcard = $(".matcard")[i-1];
				 var currentcard = $(".matcard")[i];
				 var nextcard = $(".matcard")[i+1];
				 pevcard.classList.add("pevCard");
				 currentcard.classList.remove("pevCard");
				 nextcard.classList.add("pevCard");
				 nextcard.classList.remove("pevpevCard");
				 
			 }
			 
			 if (i >= 2) {
				 $(".matcard")[i-2].classList.add("pevpevCard");
			 }
			 
			 /* if (i > 6) {
				 alert("더이상 넘길 카드가 없습니다.");
				 return;
			 } */
		 });
		 
		 $(".pev").click(()=>{
			 i--;
			if(i >= 2) {
				 var pevcard = $(".matcard")[i-1];
				 var currentcard = $(".matcard")[i];
				 var nextcard = $(".matcard")[i+1];
				 pevcard.classList.add("pevCard");
				 pevcard.classList.remove("pevpevCard");
				 currentcard.classList.remove("pevCard");
				 nextcard.classList.add("pevCard");
			} else if (i == 1) {
				var pevcard = $(".matcard")[i-1];
				 var currentcard = $(".matcard")[i];
				 var nextcard = $(".matcard")[i+1];
				 pevcard.classList.add("pevCard");
				 pevcard.classList.remove("pevpevCard");
				 currentcard.classList.remove("pevCard");
				 nextcard.classList.add("pevCard");
			} else if( i == 0) {
				var currentcard = $(".matcard")[i];
				 var nextcard = $(".matcard")[i+1];
				 currentcard.classList.remove("pevCard");
				 nextcard.classList.add("pevCard");
			}
			
			if (i <= maxSize-1 && i > 0) {
				 $(".matcard")[i+2].classList.add("pevpevCard");
			 }
			
			else if (i == 0) {
				$(".matcard")[i+3].classList.add("pevpevCard");
			}
			
		 });
		 
		
	</script>
</body>
</html>















